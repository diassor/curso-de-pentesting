Escaneos Xmas


Las baderas usasdas en los paquetes TCP son usadas para
identificar que tipo de paquete es el que estamos enviando

como con los paquetes podemos sobre pasar un firewall

##############################################
##############################################

root@kali-host:~# nmap -Pn -p22 -sT 192.168.20.23
Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-10 19:24 EDT
Nmap scan report for 192.168.20.23
Host is up (0.0019s latency).

PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 13.10 seconds

	sola hay un puerto abierto
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@2
14	13.009247875	192.168.10.5	192.168.20.23
TCP	66	51926 → 22 [RST, ACK] Seq=1 Ack=1 Win=29312
Len=0 TSval=3894722179 TSecr=19321163

(este el filtro que entrega wireshark y abajo se encuetran
los detalles del paquete capturado )
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


	asi se ve en wireshark

	Transmission Control Protocol, Src Port: 51926, Dst Port: 22, Seq: 1, Ack: 1, Len: 0
	    Source Port: 51926
	    Destination Port: 22
	    [Stream index: 0]
	    [TCP Segment Len: 0]
	    Sequence number: 1    (relative sequence number)
	    [Next sequence number: 1    (relative sequence number)]
	    Acknowledgment number: 1    (relative ack number)
	    1000 .... = Header Length: 32 bytes (8)

@(esta parte es la intersante es la activacion
	de las banderas de los paquetes )

	    Flags: 0x014 (RST, ACK)
	        000. .... .... = Reserved: Not set
	        ...0 .... .... = Nonce: Not set
	        .... 0... .... = Congestion Window Reduced (CWR): Not set
	        .... .0.. .... = ECN-Echo: Not set
	        .... ..0. .... = Urgent: Not set
	        .... ...1 .... = Acknowledgment: Set
	        .... .... 0... = Push: Not set
	        .... .... .1.. = Reset: Set
	            [Expert Info (Warning/Sequence): Connection reset (RST)]
	        .... .... ..0. = Syn: Not set
	        .... .... ...0 = Fin: Not set
	        [TCP Flags: ·······A·R··]

@(en este caso vemos que los valores de uno estan en:
	Acknowledgment  y
	reset)

	    Window size value: 229
	    [Calculated window size: 29312]
	    [Window size scaling factor: 128]
	    Checksum: 0x9f93 [unverified]
	    [Checksum Status: Unverified]
	    Urgent pointer: 0
	    Options: (12 bytes), No-Operation (NOP), No-Operation (NOP), Timestamps
	        TCP Option - No-Operation (NOP)
	            Kind: No-Operation (1)
	        TCP Option - No-Operation (NOP)
	            Kind: No-Operation (1)
	        TCP Option - Timestamps: TSval 3894722179, TSecr 19321163
	            Kind: Time Stamp Option (8)
	            Length: 10
	            Timestamp value: 3894722179
	            Timestamp echo reply: 19321163


########################################33
########################################3

lo que hace un firewall es identificar cuando una maquina esta
enviando muchos paquetes Syn o bloquean ciertos paquetes de syncronizacion
para evitar este tipo de inclusiones

En algunos casos ellos tienen configurado los protocolos
especificos o paquetes especificos , si ellos ven esas
bandejas en particular pues ellos ya  saben y lo bloquean

Hay formas en las que se pueden aprovechar  la especificacion
o la forma en la que trabajan TCP o como esta definido
TCP que se pueden utilizar para aprovechar esta fase
y sobre pasar estos dispositivos

##################################################333
#################################################3

vamos hacer lo mismo pero cambiando de parametro
	quitamos -sT y ponemos -sX

	-sX = el paquete X es un paquete critsmas (navidad)
		lo que hace es mantener todas las banderas
		en uno (1 encendidas) excepto las banderas
		que hacen referencia al SYN y al ACK

		es un paquete que dentro una comunicacion
		normal de TCP no deberia existir osea
		no tiene ninguna funcionalidad entre la
		comunicacion

		Pero lo que se hace es lanzar un paquete de este
		tipo para que  evitar que el firewall lo reconozca
		o lo identifique como un paquete que esta
		intencionado para hacer un analisis de seguridad de
		puertos ,
		el simplemente lo ignora  en algunos firewall
		lo tiene configurado y lo van a conocer y vamos
		a optener una respuesta diferente a esto.



La razon por la que se llama Xmas o critsmas viene
de una expresion que se usaba antes que se dice que el paquete esta
encendido como un arbol de navidad por que tiene todas
las banderas puestas


@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@2

root@kali-host:~# nmap -Pn -p22 -sX 192.168.20.23

	Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-10 19:51 EDT
	Nmap scan report for 192.168.20.23
	Host is up.

	PORT   STATE         SERVICE
	22/tcp open|filtered ssh

Nmap done: 1 IP address (1 host up) scanned in 15.13 seconds

nos dice que el puerto esta abierto o filtrado osea no
esta cerrado

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@2
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

vamos a analizar a wireshark

Flags: 0x029 (FIN, PSH, URG)
    000. .... .... = Reserved: Not set
    ...0 .... .... = Nonce: Not set
    .... 0... .... = Congestion Window Reduced (CWR): Not set
    .... .0.. .... = ECN-Echo: Not set
    .... ..1. .... = Urgent: Set
    .... ...0 .... = Acknowledgment: Not set
    .... .... 1... = Push: Set
    .... .... .0.. = Reset: Not set
    .... .... ..0. = Syn: Not set
    .... .... ...1 = Fin: Set
        [Expert Info (Chat/Sequence): Connection finish (FIN)]
    [TCP Flags: ······U·P··F]

tiene tres bandera encendidad menos SYN , ACK

nota :
	Deacuerdo con la especificacion TCP cuando se
	hac la definicion (cuando se establece el protocolo
	de como funciona TCP )
	La especificacion dice que si en puerto cerrado
	recibe un paquete que no tiene ninguna de las banderas
	(SYN , ACK y REST ) que son las banderas de escaneo
	el puerto deberia responder con un paquete REST
	simpre que el puerto este cerrado
	si el puerto no responde significa que el puerto esta abierto
	es una definicion un poco compleja que puede
	ser un poco dificil de asimilar pero es
	importante entenderla

	Si el puerto no me respondio y el puerto esta
	cumpliendo con el estatus de TCP
	si el puerto no responde es por que esta abierto
	si el puerto responde se puede determinar que
	el puerto esta cerrado

	Recordemos que el puerto puede esta configurado
	para no responder a ninguna de estas dos peticiones
	que no sean de su protocolo normal es un puerto filtrado

	cuando el analisis normal no presenta lo normal
	por que puede tener un firewall
	lo analisamos con Xmas(critsmas )

lo que deseamos es poder pasar por un dispositivo
de deteccion de inclusiones o a crusar un sistema de
firewall que tenga bloqueados las peticiones TCP
de afuera hacia adentro
