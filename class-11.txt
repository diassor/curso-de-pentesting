zona de transferencia y brute-force a DNS

Tipos de registros DNS

Artículo principal:
	Anexo:Listado de tipos de registros DNS

Los tipos de registros más utilizados son:

    A = Dirección (address).
		Este registro se usa para traducir nombres de
		servidores de alojamiento a direcciones IPv4.

	AAAA = Dirección (address).
		Este registro se usa en IPv6 para traducir nombres
		de hosts a direcciones IPv6.

	CNAME = Nombre canónico (canonical Name).
		Se usa para crear nombres de servidores de
		alojamiento adicionales, o alias, para los
		servidores de alojamiento de un dominio.

		Es usado cuando se están corriendo múltiples
		servicios (como FTP y servidor web) en un servidor
		con una sola dirección IP.

		Cada servicio tiene su propia entrada de DNS
		(como ftp.ejemplo.com. y www.ejemplo.com.).
		Esto también es usado cuando corres múltiples
		servidores HTTP, con diferentes nombres, sobre
		el mismo host.

		Se escribe primero el alias y luego el nombre real.
			Ej. Ejemplo1 IN CNAME ejemplo2

    NS = Servidor de nombres (name server).
		Define la asociación que existe entre un nombre
		de dominio y los servidores de nombres que
		almacenan la información de dicho dominio.

		Cada dominio se puede asociar a una cantidad
		cualquiera de servidores de nombres.

	MX = Intercambio de correo (mail exchange).
		Asocia un nombre de dominio a una lista de servidores
		de intercambio de correo para ese dominio.

		Tiene un balanceo de carga y prioridad para el
		uso de uno o más servicios de correo.

    PTR = Indicador (pointer).
		También conocido como 'registro inverso',
		funciona a la inversa del registro A,
		traduciendo IPs en nombres de dominio.

		Se usa en el archivo de configuración de la zona
		DNS inversa.

	SOA = Autoridad de la zona (start of authority).
		Proporciona información sobre el servidor DNS
		primario de la zona.

	SRV = Service record (SRV record).

    ANY = Toda la información de todos los tipos que exista.
		  (No es un tipo de registro, sino un tipo de
		  consulta)




herramienta dig
	viene preinstalada en kali
	dig sin parametros entrega una consulta en blanco

	en query o question es la pregunta
	ejemplo

root@kali-server:~# dig unal.edu.co

	; <<>> DiG 9.11.4-2-Debian <<>> unal.edu.co
	;; global options: +cmd
	;; Got answer:
	;; ->>HEADER<<- opcode: QUERY, status: NOERROR,
		id: 9928
	;; flags: qr rd ra; QUERY: 1, ANSWER: 1,
		AUTHORITY: 0, ADDITIONAL: 1

	;; OPT PSEUDOSECTION:

	; EDNS: version: 0, flags:; udp: 4000
	;; QUESTION SECTION:

	;unal.edu.co.				IN	A

	;; ANSWER SECTION:

	unal.edu.co.		1800	IN	A	35.153.234.9

	;; Query time: 163 msec

	;; SERVER: 192.168.1.1#53(192.168.1.1)

	;; WHEN: Tue May 28 22:46:19 EDT 2019

	;; MSG SIZE  rcvd: 56

no hay seccion de authority y ADDITIONAL
	por lo tanto no aparece




	root@kali-server:~# dig unal.edu.co +noall

	; <<>> DiG 9.11.4-2-Debian <<>> unal.edu.co +noall
	;; global options: +cmd
(descarta todas las secciones)



root@kali-server:~# dig unal.edu.co +noall +answer

; <<>> DiG 9.11.4-2-Debian <<>> unal.edu.co +noall +answer
;; global options: +cmd
unal.edu.co.		1800	IN	A	35.153.234.9
(descarta todas las secciones pero empieza a
asignar el parametro que nosotros querramos (+answer))


root@kali-server:~# dig unal.edu.co +noall +authority

; <<>> DiG 9.11.4-2-Debian <<>> unal.edu.co +noall +authority
;; global options: +cmd
(no muestra nada de authority por que nada esta respondiendo)



root@kali-server:~# dig @8.8.8.8 unal.edu.co

; <<>> DiG 9.11.4-2-Debian <<>> @8.8.8.8 unal.edu.co
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 19937
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;unal.edu.co.			IN	A

;; ANSWER SECTION:
unal.edu.co.		1799	IN	A	35.153.234.9

;; Query time: 46 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Tue May 28 22:58:05 EDT 2019
;; MSG SIZE  rcvd: 56

(Hemos hecho una busqueda escogiendo un servidor
predeterminado en este ejemplo el 8.8.8.8 corresponde
al servidor de google
	con el @ y el numero de ip del servidor se escoge
	el servidor para la consulta )





ahora con ANY trae mas información

root@kali-server:~# dig @8.8.8.8 unal.edu.co  ANY

; <<>> DiG 9.11.4-2-Debian <<>> @8.8.8.8 unal.edu.co ANY
; (1 server found)
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 26488
;; flags: qr rd ra; QUERY: 1, ANSWER: 20, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;unal.edu.co.			IN	ANY

;; ANSWER SECTION:
unal.edu.co.		1799	IN	A	35.153.234.9
unal.edu.co.		21599	IN	NS	ns-1198.awsdns-21.org.
unal.edu.co.		21599	IN	NS	ns-1583.awsdns-05.co.uk.
unal.edu.co.		21599	IN	NS	ns-464.awsdns-58.com.
unal.edu.co.		21599	IN	NS	ns-984.awsdns-59.net.
unal.edu.co.		899	IN	SOA	ns-1583.awsdns-05.co.uk. awsdns-hostmaster.amazon.com. 2019020418 7200 900 1209600 86400
unal.edu.co.		1799	IN	MX	10 aspmx.l.google.com.
unal.edu.co.		1799	IN	MX	20 alt1.aspmx.l.google.com.
unal.edu.co.		1799	IN	MX	20 alt2.aspmx.l.google.com.
unal.edu.co.		1799	IN	MX	30 aspmx2.googlemail.com.
unal.edu.co.		1799	IN	MX	30 aspmx3.googlemail.com.
unal.edu.co.		1799	IN	MX	30 aspmx4.googlemail.com.
unal.edu.co.		1799	IN	MX	30 aspmx5.googlemail.com.
unal.edu.co.		1799	IN	MX	50 filtromx15.unal.edu.co.
unal.edu.co.		1799	IN	MX	50 filtromx175.unal.edu.co.
unal.edu.co.		1799	IN	MX	50 filtromx61.unal.edu.co.
unal.edu.co.		1799	IN	MX	50 filtromx70.unal.edu.co.
unal.edu.co.		1799	IN	TXT	"MS=ms55463604"
unal.edu.co.		1799	IN	TXT	"Z1Y3F64MrfpX/iqU8yRHurjGEp35hG52LwBqdG9i8Ec="
unal.edu.co.		1799	IN	TXT	"v=spf1 include:_spf.unal.edu.co include:_spf.google.com ~all"

;; Query time: 56 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Tue May 28 23:03:10 EDT 2019
;; MSG SIZE  rcvd: 698


*************************************************************88888888***********

Desta manera especificamos que nos traiga solo los MX (correos
y sus respectivas respuestas )

root@kali-server:~# dig @8.8.8.8 unal.edu.co  -t MX +noall +answer

; <<>> DiG 9.11.4-2-Debian <<>> @8.8.8.8 unal.edu.co -t MX +noall +answer
; (1 server found)
;; global options: +cmd
unal.edu.co.		1349	IN	MX	10 aspmx.l.google.com.
unal.edu.co.		1349	IN	MX	20 alt1.aspmx.l.google.com.
unal.edu.co.		1349	IN	MX	20 alt2.aspmx.l.google.com.
unal.edu.co.		1349	IN	MX	30 aspmx2.googlemail.com.
unal.edu.co.		1349	IN	MX	30 aspmx3.googlemail.com.
unal.edu.co.		1349	IN	MX	30 aspmx4.googlemail.com.
unal.edu.co.		1349	IN	MX	30 aspmx5.googlemail.com.
unal.edu.co.		1349	IN	MX	50 filtromx15.unal.edu.co.
unal.edu.co.		1349	IN	MX	50 filtromx175.unal.edu.co.
unal.edu.co.		1349	IN	MX	50 filtromx61.unal.edu.co.
unal.edu.co.		1349	IN	MX	50 filtromx70.unal.edu.co.



vemos tambien los subdominios de correos electronicos


**********************************************************8

vamos a forzar en la zona de trsanferencia algun servidor
Ejemplo
	En el servidor de google 8.8.8.8 le decimos que nos
	envie a una zona de transferencia e incluyame
	todo

	AXFR (comando para forzar una zona de transferencia)

	root@kali-server:~# dig @8.8.8.8 unal.edu.co  -t AXFR

	; <<>> DiG 9.11.4-2-Debian <<>> @8.8.8.8 unal.edu.co -t AXFR
	; (1 server found)
	;; global options: +cmd
	; Transfer failed.
cuando un servidor DNS esta bien administrado, bien protegido
el resultado es que la transferencia va a fallar , por razones
de seguridad
En este caso hacemos un ataque de fuerza bruta

man fierce
	es el comando que se usa

	root@kali-server:~# fierce --h
	fierce (C) Copywrite 2006,2007 - By RSnake at http://ha.ckers.org/fierce/

		Usage: fierce [-dns example.com] [OPTIONS]

	Overview:
		Fierce is a semi-lightweight scanner that helps locate non-contiguous
		IP space and hostnames against specified domains.  It's really meant
		as a pre-cursor to nmap, unicornscan, nessus, nikto, etc, since all
		of those require that you already know what IP space you are looking
		for.  This does not perform exploitation and does not scan the whole
		internet indiscriminately.  It is meant specifically to locate likely
		targets both inside and outside a corporate network.  Because it uses
		DNS primarily you will often find mis-configured networks that leak
		internal address space. That's especially useful in targeted malware.

	Options:
		-connect	Attempt to make http connections to any non RFC1918
			(public) addresses.  This will output the return headers but
			be warned, this could take a long time against a company with
			many targets, depending on network/machine lag.  I wouldn't
			recommend doing this unless it's a small company or you have a
			lot of free time on your hands (could take hours-days).
			Inside the file specified the text "Host:\n" will be replaced
			by the host specified. Usage:

		fierce -dns example.com -connect headers.txt

		-delay		The number of seconds to wait between lookups.
		-dns		The domain you would like scanned.
		-dnsfile  	Use DNS servers provided by a file (one per line) for
	                reverse lookups (brute force).
		-dnsserver	Use a particular DNS server for reverse lookups
			(probably should be the DNS server of the target).  Fierce
			uses your DNS server for the initial SOA query and then uses
			the target's DNS server for all additional queries by default.
		-file		A file you would like to output to be logged to.
		-fulloutput	When combined with -connect this will output everything
			the webserver sends back, not just the HTTP headers.
		-help		This screen.
		-nopattern	Don't use a search pattern when looking for nearby
			hosts.  Instead dump everything.  This is really noisy but
			is useful for finding other domains that spammers might be
			using.  It will also give you lots of false positives,
			especially on large domains.
		-range		Scan an internal IP range (must be combined with
			-dnsserver).  Note, that this does not support a pattern
			and will simply output anything it finds.  Usage:

		fierce -range 111.222.333.0-255 -dnsserver ns1.example.co

		-search		Search list.  When fierce attempts to traverse up and
			down ipspace it may encounter other servers within other
			domains that may belong to the same company.  If you supply a
			comma delimited list to fierce it will report anything found.
			This is especially useful if the corporate servers are named
			different from the public facing website.  Usage:

		fierce -dns examplecompany.com -search corpcompany,blahcompany

			Note that using search could also greatly expand the number of
			hosts found, as it will continue to traverse once it locates
			servers that you specified in your search list.  The more the
			better.
		-suppress	Suppress all TTY output (when combined with -file).
		-tcptimeout	Specify a different timeout (default 10 seconds).  You
			may want to increase this if the DNS server you are querying
			is slow or has a lot of network lag.
		-threads  Specify how many threads to use while scanning (default
		  is single threaded).
		-traverse	Specify a number of IPs above and below whatever IP you
			have found to look for nearby IPs.  Default is 5 above and
			below.  Traverse will not move into other C blocks.
		-version	Output the version number.
		-wide		Scan the entire class C after finding any matching
			hostnames in that class C.  This generates a lot more traffic
			but can uncover a lot more information.
		-wordlist	Use a seperate wordlist (one word per line).  Usage:

		fierce -dns examplecompany.com -wordlist dictionary.txt



		root@kali-server:~# fierce -dns unal.edu.co -w dnsmap.txt
		Option w is ambiguous (wide, wordlist)
		DNS Servers for unal.edu.co:
			ns-1198.awsdns-21.org
			ns-1583.awsdns-05.co.uk
			ns-464.awsdns-58.com
			ns-984.awsdns-59.net

		Trying zone transfer first...
			Testing ns-1198.awsdns-21.org
				Request timed out or transfer not allowed.
			Testing ns-1583.awsdns-05.co.uk
				Request timed out or transfer not allowed.
			Testing ns-464.awsdns-58.com
				Request timed out or transfer not allowed.
			Testing ns-984.awsdns-59.net
				Request timed out or transfer not allowed.

trato de hacer el ataque en la zona de transferencia
y fallo ahora el dice que lo va hacer de fuerza bruta a Los
servidores


Unsuccessful in zone transfer (it was worth a shot)
Okay, trying the good old fashioned way... brute force

Checking for wildcard DNS...

en este momento esta atacando para buscar otras dns
que listan de manera convencional


Checking for wildcard DNS...
Nope. Good.
Now performing 2280 test(s)...
168.176.239.43	antivirus.unal.edu.co

Demora algun tiempo pero alcanzo a dar esta información
