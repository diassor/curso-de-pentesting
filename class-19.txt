Nmap Scripting Engine

herramienta muy poderosa para el analisis de un segmento de Red


Vamos a ver algunas de las opciones que tiene nmap
y otras aplicaciones como metasploit
que es lo usan de nmap y como nmap sepuede convertir
aun en mas poderosa

nmap man :
	tiene muchos parametros para revizar
	vamos a ver los Scripting

el motor de Scripting es donde podemos escribir
a traves de lineas de comandos
diferentes lineas de comandos para que el pueda
ejecutar los comandos en series y me devuelva resultados
apartir de lo que obtiene de los diferentes comandos


SCRIPT SCAN:
     -sC: equivalent to --script=default
        --script=<Lua scripts>: <Lua scripts> is a comma
			separated list of directories,
			script-files or script-categories

		--script-args=<n1=v1,[n2=v2,...]>:
			provide arguments to scripts

		--script-args-file=filename:
			provide NSE script args in a file

		--script-trace:
			Show all data sent and received

		--script-updatedb:
			Update the script database.

		--script-help=<Lua scripts>:
			Show help about scripts.
                      <Lua scripts> is a comma-separated
					  list of script-files or script-categories.


nota :
	este video es solo el inicio de lo grande que es
	nmap usado con otras muchas herramientas de explotacion
	de vulnerabilidades


para usasr los scripts que tiene nmap le ponemos parametros
osea el nombre del script que vamos a usar

###################################
ejemplo
	El banner grabin es que cuando yo envio ciertos
	paquetes con ciertos tipos de solicitudes el servidor
	me responde y la respuesta del servidor en muchas
	ocaciones me incluye el nombre del servicio que le estoy
	proporcionando

		cuando yo envio una peticion Http (de servicios web )
		regularmente el va a responder con la version
		del servidor web que esta utilizando esto es muy
		util para identificar versiones (con eso podemos
		que vulnerabilidades podemos tener en cuenta )
		en este caso vamos a apuntar a muchos puertos
		para saber que sercios se estan utilizando en
		cada uno de ellos


@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@

el resultado es parecido a los anteriores

root@kali-host:~# nmap --script banner 192.168.20.23
	Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-11 00:08 EDT
	Nmap scan report for 192.168.20.23
	Host is up (0.00070s latency).
	Not shown: 998 closed ports
	PORT   STATE SERVICE

	22/tcp open  ssh
	|_banner: SSH-2.0-OpenSSH_7.4p1 Debian-10+deb9u6

	80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 28.80 seconds

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
El princio del banner grabin se basa en la idea que la
respuesta dentro del SYN-ACK o de las primeras
comunicaciones que se hacen en una transaccion TCP
generalmente incluye en las primeras lineas la version
del sistema que se esta utilizando .

si yo me estoy tratando de conectar a un servidor FTP  como en
este caso

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
root@kali-host:~# nmap --script banner -Pn -p-  192.168.20.23  > datos-script-banner.txt

root@kali-host:~# cat datos-script-banner.txt
	Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-11 00:17 EDT
	Nmap scan report for 192.168.20.23
	Host is up (0.0019s latency).
	Not shown: 65533 closed ports


nota:
	en este caso el puerto esta abierto y esta usando un SSH
	debian


	PORT   STATE SERVICE
	22/tcp open  ssh
	|_banner: SSH-2.0-OpenSSH_7.4p1 Debian-10+deb9u6


	80/tcp open  http

Nmap done: 1 IP address (1 host up) scanned in 37.71 seconds

###############################################
#############################################
ahora con -sX


root@kali-host:~# cat sxdatos-script-banner.txt
Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-11 00:21 EDT
Nmap scan report for 192.168.20.23
Host is up (0.00054s latency).
Not shown: 65533 closed ports
PORT   STATE         SERVICE

(identifico que el servidor es un debian )
22/tcp open|filtered ssh
|_banner: SSH-2.0-OpenSSH_7.4p1 Debian-10+deb9u6

80/tcp open|filtered http

Nmap done: 1 IP address (1 host up) scanned in 36.98 seconds

#################################################
################################################

nmap --script vuln 192.168.20.23

root@kali-host:~# cat vuln-script.txt

Starting Nmap 7.70 ( https://nmap.org ) at 2019-06-11 00:33 EDT

Pre-scan script results:
| broadcast-avahi-dos:
|   Discovered hosts:
|     224.0.0.251
|   After NULL UDP avahi packet DoS (CVE-2011-1002).
|_  Hosts are all up (not vulnerable).

Nmap scan report for 192.168.20.23
Host is up (0.0013s latency).
Not shown: 998 closed ports

PORT   STATE SERVICE
22/tcp open  ssh
80/tcp open  http
| http-csrf:
| Spidering limited to: maxdepth=3; maxpagecount=20; withinhost=192.168.20.23
|   Found the following possible CSRF vulnerabilities:
|
|     Path: http://192.168.20.23:80/manual/fr/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/pt-br/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/en/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/de/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/ja/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/zh-cn/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/tr/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/es/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/da/index.html
|     Form id:
|     Form action: http://www.google.com/search
|
|     Path: http://192.168.20.23:80/manual/ko/index.html
|     Form id:
|_    Form action: http://www.google.com/search
|_http-dombased-xss: Couldn't find any DOM based XSS.
| http-enum:
|_  /manual/: Potentially interesting folder
|_http-stored-xss: Couldn't find any stored XSS vulnerabilities.

Nmap done: 1 IP address (1 host up) scanned in 69.52 seconds

(este fue mi resltado )



	demora un poco ya que ejecuta muchas vulnerabilidades
	el resultado que le dio al profesor
	es muy completo mostrando muchas vulneravilidades
	a cada puerto que encontro

	cada resultado de puerto trae su vulnerabilidad
	con alguanas referencias que podemos consultar
	para saber como lo podemos explotar

nota

todos los scripts que estan en referencia directamente en Nmap
https://nmap.org/nsedoc/
